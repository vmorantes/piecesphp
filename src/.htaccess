##### CABECERAS - INICIO #####

<IfModule mod_headers.c>

    # Restricción de enmarcado (establece dónde puede ser puesto este sitio en un iframe)
	Header set X-Frame-Options "SAMEORIGIN"

    # Obliga a que el navegador no cargue un elemento a menos que el MIME haya sido declarado correctamente
	Header set X-Content-Type-Options "nosniff"

    # X-XSS-Protection
    Header set X-XSS-Protection "1; mode=block"

    # Forzar HSTS a 44 semanas
    <If "%{HTTP_HOST} != 'localhost'">
        Header set Strict-Transport-Security "max-age=26611200; includeSubDomains; preload"
    </If>

    # Configurar política de contenido
    Header set Content-Security-Policy "default-src https: data: blob: 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://api.mapbox.com https://twemoji.maxcdn.com; script-src https: 'self' 'unsafe-inline' https://twemoji.maxcdn.com; object-src 'none'; worker-src blob:"
    <IfModule mod_expires.c>
        # Desactivar módulo Expires
        ExpiresActive Off
    </IfModule>
</IfModule>

##### CABECERAS - FIN #####

##### REESCRITURA - INICIO #####

#Activar redirección para el funcionamiento de las rutas
RewriteEngine on

# Redirect HTTP to HTTPS
RewriteCond %{HTTP_HOST} !=localhost
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Redirect HTTPS to HTTP
##RewriteCond %{HTTP:X-Forwarded-Proto} =https
##RewriteRule ^(.*)$ http://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Redirect www to non-www
##RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
##RewriteRule ^(.*)$ http://%1/$1 [R=301,L]

RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule . index.php [L]

##### REESCRITURA - FIN #####

##### CONTROL DE ACCESO - INICIO #####

#Desactivar el listado de directorios
Options -Indexes

#Prohibir acceso a algunos archivos
<FilesMatch "\.(sass|scss|htaccess|php|gitignore|zip|ts)$">
	<IfVersion >= 2.4>
		Deny from All
	</IfVersion>
	<IfVersion < 2.4>
		Require all denied
	</IfVersion>
</FilesMatch>

#Prohibir acceso a composer.lock, composer.json y gulpfile.js
<FilesMatch "^(composer\.lock|composer\.json|gulpfile\.js)$">
	<IfVersion >= 2.4>
		Deny from All
	</IfVersion>
	<IfVersion < 2.4>
		Require all denied
	</IfVersion>
</FilesMatch>

#Permitir acceso php solo a index.php
<FilesMatch "^index.php$">
	<IfVersion >= 2.4>
		Allow from All
	</IfVersion>
	<IfVersion < 2.4>
		Require all granted
	</IfVersion>
</FilesMatch>

##### CONTROL DE ACCESO - FIN #####

##### PROCESAMIENTO - INICIO #####
## Compresión
<IfModule mod_deflate.c>
    # Activar la compresión
    SetOutputFilter DEFLATE
    # Comprimir archivos de texto
    AddOutputFilterByType DEFLATE image/*
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/shtml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/pdf
    # Comprimir archivos específicos por extensión
    AddOutputFilterByType DEFLATE application/javascript "js"
    AddOutputFilterByType DEFLATE text/css "css"
    AddOutputFilterByType DEFLATE image/x-icon "ico"
    AddOutputFilterByType DEFLATE application/x-shockwave-flash "swf"
    AddOutputFilterByType DEFLATE audio/mpeg "mp3"
    AddOutputFilterByType DEFLATE video/mp4 "mp4"
    AddOutputFilterByType DEFLATE text/csv "csv"
    AddOutputFilterByType DEFLATE application/pdf "pdf"
    AddOutputFilterByType DEFLATE application/font-woff2 "woff2"
    AddOutputFilterByType DEFLATE application/font-woff "woff"
    AddOutputFilterByType DEFLATE application/x-font-ttf "ttf"
    AddOutputFilterByType DEFLATE application/vnd.ms-fontobject "eot"
    # Desactivar la compresión para navegadores antiguos que tienen problemas con Gzip
    BrowserMatch ^Mozilla/4 gzip-only-text/html
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
    BrowserMatch \bMSI[E] !no-gzip !gzip-only-text/html
</IfModule>
##### PROCESAMIENTO - FIN #####
